<script src="{{ .Site.BaseURL }}legacycaljs/fullcalendar/core/main.min.js"></script>
<script src="{{ .Site.BaseURL }}legacycaljs/fullcalendar/daygrid/main.min.js"></script>
<script src="{{ .Site.BaseURL }}legacycaljs/fullcalendar/timegrid/main.min.js"></script>

{{ partial "cal/scripts.html" . }}
{{ partial "cal/special-events.html" . }}

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('fullcalendar');
    var params = parseURL();

    var default_view = 'timeGridWeek';
    switch (params['view']) {
      case 'day':
        default_view = 'timeGridDay';
        break;
      case 'week':
        default_view = 'timeGridWeek';
        break;
      case 'month':
        default_view = 'dayGridMonth';
        break;
    }

    var calendar = new FullCalendar.Calendar(calendarEl, {
      plugins: [ 'dayGrid', 'timeGrid' ],
      defaultView: default_view,
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      defaultDate: params['startdate'],
      nowIndicator: true,
      eventLimit: true,
      navLinks: true,
      eventSources: [
        {
          url: '{{ .Site.BaseURL }}api/events.php',
          startParam: 'startdate',
          endParam: 'enddate',
          success: function( content ) {
            // our API returns { "events": [ ] }
            // and this will return just the inner array as fullcalendar expects
            return content.events;
          },
          eventDataTransform: function( eventData ) {
            // this transforms the data for individual rides
            // into the format needed by fullcalendar
            var event = {
                id: eventData.caldaily_id,
                title: (eventData.tinytitle ? eventData.tinytitle : eventData.title),
                start: eventData.date + 'T' + eventData.time,
                url: '/calendar/event-' + eventData.caldaily_id,
            };

            event.classNames = [];
            if (eventData.cancelled == true) {
              event.classNames.push('cancelled');
            }
            if (eventData.featured == true) {
              event.classNames.push('featured');
            }
            return event;
          },
        },
        {
          events: pedalpaloozaEvents, // from special-events.html
          allDayDefault: true,
          color: "#D34212",
          eventDataTransform: function( eventData ) {
            var event = {
                title: eventData.title,
                start: eventData.start,
                end: eventData.end,
                url: eventData.url
            };

            event.classNames = ["pedalpalooza"];
            if (eventData.cancelled == true) {
              event.classNames.push('cancelled');
            }

            return event;
          },
        },
        {
          events: bikeMoreChallengeEvents, // from special-events.html
          allDayDefault: true,
          color: "#4212D3",
          eventDataTransform: function( eventData ) {
            var event = {
                title: eventData.title,
                start: eventData.start,
                end: eventData.end,
                url: eventData.url
            };

            event.classNames = ["bike-more-challenge"];
            if (eventData.cancelled == true) {
              event.classNames.push('cancelled');
            }

            return event;
          },
        },

      ]
    });

    calendar.render();
  });
</script>
